---
title: "Projet de Modélisation Prédictive"
author: "Arthur Reidenbach et Raphael Bordas"
date: "Mars 2024"
output: pdf_document
---

```{r setup, include = FALSE}
# rm(list = objects())
# graphics.off()
library(tidyverse)
library(lubridate)
library(quantreg)
library(mgcv)
library(readxl)
library(qgam)
library(mgcv)

# custom utilities scripts
source('utils/score.R')
source('utils/utils.R')
source('_01_preprocess_data.R') # to get the data for the plots

knitr::opts_template$set(centered = list(
  # fig.width = 10, fig.height = 6,
  # fig.retina = 2, 
  out.width = '60%',
  fig.align = 'center',
  echo = FALSE
))
```

## Motivation

Avec la part croissante des énergies renouvelables dans le mix électrique en France, il devient majeur de pouvoir prédire la demande nette de production électrique, c'est-à-dire la charge globale du réseau (`Load` dans le jeu de données) moins les productions renouvelables. Le jeu de données fourni se concentre sur la dernière décennie, avec pour objectif la prédiction de la demande nette lors de la période de sobriété énergétique de septembre 2022 à octobre 2023. 

## Nettoyage des données et analyse exploratoire

### Choix des données d'entrainement

Puisque nous n'avons pas accès aux données test (en terme de demande nette), nous procédons par validation sur un sous-échantillon du jeu d'entrainement original (`Data0` dans le code). Plusieurs méthodes peuvent être envisagées :

1. Entrainement entre 2013 et 2021 inclus, validation entre le 01/01/2022 et le 01/09/2022. 

2. Entrainement entre 2018 et 2021 inclus, validation entre le 01/01/2022 et le 01/09/2022. 

3. Entrainement entre le 01/01/2018 et le 01/09/2022, validation sur 365 points aléatoirement choisis entre le 01/01/2021 et le 01/09/2022 et exclus de l'entrainement.

La motivation pour entrainer les modèles à partir de 2018 (méthode 2 et 3) vient essentiellement des observations suivantes : changement de comportements de certaines séries temporelles (par exemple augmentation de la production éolienne observable sur la Figure 2), de la définition et du calcul de la nébulosité pondéré par la production (`Nebulosity_weighted`) à partir de 2018 (Figure 3). De manière générale, il a été observé de meilleures performances à modèles identiques lorsque l'entrainement commence en 2018. 

De plus, il est également intéressant de prendre des points de validation aléatoire, pour éviter une évaluation biaisée de la performance : la méthode 2 n'évalue la performance d'un modèle que sur 3 saisons. Or, ainsi que le montre la Figure 1, la série temporelle d'intérêt présente une saisonnalité annuelle très marquée. Il est donc primodial d'évaluer également le modèle sur octobre-novembre-décembre.

Enfin, il a été décidé de prendre en compte la pandémie du Covi-19. Nous avons testé deux méthodes :

- un index de confinement (*strengency index*^[Hale, T., Angrist, N., Goldszmidt, R. et al. A global panel database of pandemic policies (Oxford COVID-19 Government Response Tracker). Nat Hum Behav 5, 529–538 (2021). https://doi.org/10.1038/s41562-021-01079-8]) pour prendre en compte l'effet de la pandémie du Covid-19 sur la consommation électrique en France. Plus précisement, les périodes avec un index supérieur ou égal à 80 ont été exclu de l'entrainement (correspondant au premier confinement du printemps 2020).

- un codage 'one-hot' des trois confinements.

```{r fig.cap = "Net load of the training and validation datasets", opts.label="centered"}
par(mfrow=c(1,1))
plot(train_data$Date, train_data$Net_demand, type='l', xlim=range(train_data$Date, val_data$Date), main = "", xlab = "Date", ylab = "Net demand (MW)")
lines(val_data$Date, val_data$Load, type='l', col = "blue")
legend("top", legend = c("Train", "Validation"), col = c("black", "blue"), ncol = 2, lty = 1)
```

```{r fig.cap = "Load (blue), wind power (green) and solar power (red)", opts.label="centered"}
col <- yarrr::piratepal("basel")
par(mfrow=c(1,1))
plot(Data0$Date, Data0$Load, type='l', col=col[1], ylim = c(0, 90000), xlab = "Date", ylab = "Load (MW)")
lines(Data0$Date, Data0$Solar_power, col=col[2])
lines(Data0$Date, Data0$Wind_power, col=col[3])
```

```{r}

```


